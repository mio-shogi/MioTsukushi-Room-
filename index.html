<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Mio Tsukushi Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300&family=Noto+Serif+JP:wght@300&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Noto Serif JP', serif; background:#f7f2e9; color:#1c1710; overflow-x:hidden; }
        
        /* Navigation */
        #nav { position:fixed; top:0; width:100%; display:flex; justify-content:center; background:rgba(247,242,233,.95); z-index:1000; border-bottom:1px solid rgba(184,149,48,.2); }
        #nav button { background:none; border:none; padding:1.2rem 2rem; font-family:'Cormorant Garamond', serif; letter-spacing:0.2em; cursor:pointer; color:#1c1710; opacity:0.6; }
        #nav button:hover { opacity:1; color:#b89530; }

        .room { display:none; padding-top:100px; min-height:100vh; width:100vw; flex-direction:column; align-items:center; }

        /* Shogi Board: CSSだけで線を引く */
        #shogi-layout { display:flex; align-items:center; gap:40px; margin-top: 20px; }
        #board { 
            display: grid; grid-template-columns: repeat(9, 54px); grid-template-rows: repeat(9, 54px); 
            background:#d4a95a; border:3px solid #5d4037; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .cell { 
            width:54px; height:54px; border:0.5px solid #2a1808; 
            display:flex; justify-content:center; align-items:center; 
        }
        .koma { 
            width:42px; height:48px; background:#faecd5; border:1px solid #7a5230; 
            display:flex; justify-content:center; align-items:center; cursor:grab; 
            font-weight:bold; font-size:1.2rem; user-select:none;
            clip-path: polygon(50% 0%, 100% 20%, 85% 100%, 15% 100%, 0% 20%);
        }
        .gote { transform: rotate(180deg); }
        .komadai { width:120px; height:220px; background:#e3c08d; border:2px solid #5d4037; box-shadow: 4px 4px 10px rgba(0,0,0,0.1); }
        .clock { font-family:'Cormorant Garamond', serif; font-size:1.8rem; background:#1c1710; color:#b89530; padding:10px; margin:15px 0; text-align:center; min-width:140px; border:1px solid #b89530; border-radius:4px; }

        /* Home Style */
        .poem-box { margin-top: 60px; text-align:center; max-width:600px; padding:40px; border-top:1px solid #b89530; }
        .poem-text { font-size:1.6rem; line-height:2.8; margin-bottom:30px; }
    </style>
</head>
<body>

    <nav id="nav">
        <button onclick="show('home')">HOME</button>
        <button onclick="show('shogi')">SHOGI GAME</button>
        <button onclick="show('medical')">MEDICAL</button>
        <button onclick="show('private')">PRIVATE</button>
    </nav>

    <div id="home" class="room" style="display:flex;">
        <h1 style="font-family:'Cormorant Garamond'; font-size:3.5rem; letter-spacing:0.1em;">Sanctuary of enjoi</h1>
        <div class="poem-box">
            <p class="poem-text">みをつくし 心尽して 思へかも<br>ここにももとな 夢にし見ゆる</p>
            <p style="opacity:0.7; font-size:0.9rem; text-align:left;">【万葉集 3162】<br>身を尽くし、心を尽くして想うからこそ、しきりに夢にまで現れるのでしょう。</p>
        </div>
    </div>

    <div id="shogi" class="room">
        <div id="shogi-layout">
            <div style="text-align:center;">
                <div class="komadai"></div>
                <div id="clock-gote" class="clock">10:00</div>
                <p style="color:#b89530; font-size:0.8rem;">GOTE</p>
            </div>
            
            <div id="board"></div>
            
            <div style="text-align:center;">
                <p style="color:#b89530; font-size:0.8rem;">SENTE</p>
                <div id="clock-sente" class="clock">10:00</div>
                <div class="komadai"></div>
            </div>
        </div>
    </div>

    <div id="medical" class="room"><h1>Medical Room</h1></div>
    <div id="private" class="room"><h1>Private Room</h1></div>

<script>
    let active = null, times = {sente:600, gote:600}, isByo = {sente:false, gote:false};
    
    function show(id) {
        document.querySelectorAll('.room').forEach(r => r.style.display = 'none');
        document.getElementById(id).style.display = 'flex';
        if(id === 'shogi') initBoard();
    }

    setInterval(() => {
        if(!active) return;
        if(times[active] > 0) {
            times[active]--;
        } else if(!isByo[active]) {
            isByo[active] = true; times[active] = 30;
        } else if(times[active] > 0) {
            times[active]--;
        }
        updateUI();
    }, 1000);

    function updateUI() {
        ['sente','gote'].forEach(s => {
            const el = document.getElementById(`clock-${s}`);
            const m = Math.floor(times[s]/60).toString().padStart(2,'0'), sc = (times[s]%60).toString().padStart(2,'0');
            el.textContent = isByo[s] ? `BYO: ${sc}` : `${m}:${sc}`;
            el.style.boxShadow = active === s ? "0 0 20px #fff" : "none";
            if(isByo[s]) el.style.color = "#ff4500";
        });
    }

    function initBoard() {
        const b = document.getElementById('board');
        if(b.children.length > 0) return;
        
        const layout = {
            '0-0':'香','1-0':'桂','2-0':'銀','3-0':'金','4-0':'玉','5-0':'金','6-0':'銀','7-0':'桂','8-0':'香','1-1':'飛','7-1':'角',
            '0-8':'香','1-8':'桂','2-8':'銀','3-8':'金','4-8':'王','5-8':'金','6-8':'銀','7-8':'桂','8-8':'香','7-7':'飛','1-7':'角'
        };

        for(let i=0; i<81; i++) {
            const x = i%9, y = Math.floor(i/9), cell = document.createElement('div');
            cell.className = 'cell'; cell.dataset.pos = `${x}-${y}`;
            cell.ondragover = e => e.preventDefault();
            cell.ondrop = e => {
                e.preventDefault();
                const fromPos = e.dataTransfer.getData('text');
                const piece = document.querySelector(`[data-id="${fromPos}"]`);
                const toCell = e.target.classList.contains('cell') ? e.target : e.target.parentElement;
                if(toCell.firstChild) toCell.removeChild(toCell.firstChild);
                toCell.appendChild(piece);
                active = piece.dataset.side === 'gote' ? 'sente' : 'gote';
            };

            const k = layout[`${x}-${y}`] || (y===2 || y===6 ? '歩' : null);
            if(k) {
                const p = document.createElement('div');
                p.className = 'koma' + (y<3 ? ' gote' : '');
                p.textContent = k; p.draggable = true;
                p.dataset.id = `k-${i}`; p.dataset.side = (y<3 ? 'gote' : 'sente');
                p.ondragstart = e => e.dataTransfer.setData('text', e.target.dataset.id);
                cell.appendChild(p);
            }
            b.appendChild(cell);
        }
    }
</script>
</body>
</html>
