<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Mio Tsukushi Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&family=Noto+Serif+JP:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #f7f2e9; overflow: hidden; font-family: 'Noto Serif JP', serif; }
        canvas { display: block; cursor: pointer; }
        #overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #f7f2e9; z-index: 100; }
        input { padding: 15px; font-size: 1.2rem; border: 1px solid #b89530; background: transparent; text-align: center; outline: none; font-family: 'Cormorant Garamond', serif; }
    </style>
</head>
<body>

<div id="overlay">
    <input type="password" id="pass" placeholder="Passphrase" onkeydown="if(event.key==='Enter') start()">
</div>
<canvas id="stage"></canvas>

<script>
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
let scene = 'cover1'; // cover1(歌), cover2(説明文字), lobby, room_med, room_pri, room_shogi
const imgs = {};
const files = {
    img1: 'medical_hands.jpg',
    img2: 'antique_library.jpg',
    img3: 'medical.png',
    img4: 'private.png'
};

function start() {
    if(document.getElementById('pass').value !== 'enjoi') return;
    document.getElementById('overlay').style.display = 'none';
    load();
}

function load() {
    let loaded = 0;
    const targets = Object.keys(files);
    targets.forEach(key => {
        imgs[key] = new Image();
        imgs[key].src = files[key];
        imgs[key].onload = () => { loaded++; if(loaded === targets.length) render(); };
    });
}

function render() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (scene === 'cover1') {
        // 1枚目：万葉集の歌
        drawText("みをつくし 心尽して 思へかも", canvas.height/2 - 30, 28);
        drawText("ここにももとな 夢にし見ゆる", canvas.height/2 + 30, 28);
    } 
    else if (scene === 'cover2') {
        // 2枚目：文字による説明（ここを実里さんの言葉に戻しました）
        ctx.fillStyle = '#1c1710';
        ctx.font = '300 18px "Noto Serif JP"';
        ctx.textAlign = 'center';
        const description = [
            "意味：私が身を尽くし、心を尽くして、あの人のことを想っているからでしょうか。",
            "こんなにもしきりに、あの人のことが夢に見えるのは。",
            "",
            "思索の深さを物語る、静謐な書庫への入り口。"
        ];
        description.forEach((line, i) => {
            ctx.fillText(line, canvas.width/2, canvas.height/2 - 60 + i*40);
        });
    } 
    else if (scene === 'lobby') {
        // ロビーの表題
        ctx.fillStyle = '#1c1710';
        ctx.font = '300 42px "Cormorant Garamond"';
        ctx.textAlign = 'center';
        ctx.fillText("Entrance Lobby", canvas.width/2, 120);
        ctx.font = '300 20px "Noto Serif JP"';
        ctx.fillText("MioRoomへようこそ", canvas.width/2, 170);

        // 3つの扉：写真は全体に貼り、下半分は板
        drawRealisticDoor(canvas.width/2 - 320, 280, imgs.img3, "医学");
        drawRealisticDoor(canvas.width/2 - 75, 280, imgs.img4, "思索");
        drawRealisticDoor(canvas.width/2 + 170, 280, null, "将棋");
    }
    else {
        // 各部屋：中にある写真は切れないように描画
        const roomImg = (scene === 'room_med') ? imgs.img1 : (scene === 'room_pri') ? imgs.img2 : null;
        if(roomImg) {
            const s = Math.min(canvas.width*0.8/roomImg.width, canvas.height*0.8/roomImg.height);
            ctx.drawImage(roomImg, (canvas.width-roomImg.width*s)/2, (canvas.height-roomImg.height*s)/2, roomImg.width*s, roomImg.height*s);
        } else {
            // 将棋盤
            ctx.fillStyle = '#d4a95a';
            ctx.fillRect(canvas.width/2-225, canvas.height/2-225, 450, 450);
        }
        ctx.fillStyle = '#b89530';
        ctx.font = '16px "Noto Serif JP"';
        ctx.fillText("← BACK", 80, 50);
    }
}

function drawRealisticDoor(x, y, img, label) {
    const w = 150, h = 350;
    // 扉の枠
    ctx.strokeStyle = '#3d2f25';
    ctx.lineWidth = 6;
    ctx.strokeRect(x, y, w, h);

    if(img) {
        // 【実里さんの指示通り】扉全体に写真を貼り、下半分を板で隠す
        ctx.save();
        ctx.beginPath();
        ctx.rect(x+3, y+3, w-6, h-6);
        ctx.clip();
        const s = Math.max(w/img.width, h/img.height);
        ctx.globalAlpha = 0.8;
        ctx.drawImage(img, x + (w-img.width*s)/2, y + (h-img.height*s)/2, img.width*s, img.height*s);
        ctx.restore();
    } else {
        ctx.fillStyle = '#96a996'; // 将棋用
        ctx.fillRect(x+3, y+3, w-6, h-6);
    }

    // 下半分を重厚な板で隠す（これが「自然な扉」）
    ctx.globalAlpha = 1.0;
    ctx.fillStyle = '#4a3d33';
    ctx.fillRect(x, y + h/2, w, h/2);
    ctx.strokeStyle = '#3d2f25';
    ctx.strokeRect(x, y + h/2, w, h/2);

    ctx.fillStyle = '#f7f2e9';
    ctx.font = '16px "Noto Serif JP"';
    ctx.textAlign = 'center';
    ctx.fillText(label, x + w/2, y + h * 0.85);
}

function drawText(txt, y, size) {
    ctx.fillStyle = '#1c1710';
    ctx.font = `300 ${size}px "Noto Serif JP"`;
    ctx.textAlign = 'center';
    ctx.fillText(txt, canvas.width/2, y);
}

canvas.addEventListener('click', (e) => {
    const x = e.clientX, y = e.clientY;
    if (scene === 'cover1') scene = 'cover2';
    else if (scene === 'cover2') scene = 'lobby';
    else if (scene === 'lobby') {
        if(y > 280 && y < 630) {
            if(x > canvas.width/2 - 320 && x < canvas.width/2 - 170) scene = 'room_med';
            else if(x > canvas.width/2 - 75 && x < canvas.width/2 + 75) scene = 'room_pri';
            else if(x > canvas.width/2 + 170 && x < canvas.width/2 + 320) scene = 'room_shogi';
        }
    } else {
        if(x < 150 && y < 100) scene = 'lobby';
    }
    render();
});

window.addEventListener('resize', render);
</script>
</body>
</html>
